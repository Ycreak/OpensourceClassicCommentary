<!-- I think this can be removed. -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

<!-- Maybe we should get a local stylesheet? -->
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<!-- Simple toolbar with all the different buttons and the title -->
<mat-toolbar color="primary">
    <span><h3 class='h3-title'>Dashboard</h3></span>
    <span class="spacer"></span>
    <button mat-button class="btn" (click)="RequestAuthors()">RELOAD AUTHORS</button>
    <button mat-button (click)="Test('hoi')">Test</button>
</mat-toolbar>

<!-- Show a spinner if query with database is in progress -->
<mat-progress-bar mode="query" *ngIf="this.spinner"></mat-progress-bar>
<br>


<!-- SELECTING ROW -->
<div class="container-fluid">
    <div class="row">
        <!-- Need some space here please  -->     
        <mat-form-field class="select-form">
            <mat-label>Author</mat-label>
            <mat-select [(ngModel)]="selectedAuthor">
                <mat-option *ngFor="let authorData of this.authorsJSON" [value]="authorData"
                (click)="this.selectedBook = this.selectedEditor = this.selectedFragment = this.selectedLine = ''"
                (click)="this.fragmentForm.reset(); this.contentForm.reset(); this.contextForm.reset()"
                (click)="RequestBooks(authorData.id)">
                {{ authorData.name }}                       
                </mat-option>
            </mat-select>
            <mat-hint>Select an author</mat-hint>
        </mat-form-field>
    
        <mat-form-field class="select-form">
            <mat-label>Book</mat-label>
            <mat-select [(ngModel)]="selectedBook">
            <mat-option *ngFor="let bookData of this.booksJSON" [value]="bookData"
            (click)="this.selectedEditor = this.selectedFragment = this.selectedLine = ''"
            (click)="this.fragmentForm.reset(); this.contentForm.reset(); this.contextForm.reset()"
            (click)="this.RequestEditors(bookData.id)"
            (click)="this.RequestFragments(bookData.id)">
                {{ bookData.title }}                       
            </mat-option>
            </mat-select>
            <mat-hint>Select a book</mat-hint>
        </mat-form-field>
    
        <mat-form-field class="select-form">
            <mat-label>Editor</mat-label>
            <mat-select [(ngModel)]="selectedEditor">
            <mat-option *ngFor="let editorData of this.editorsJSON" [value]="editorData"
            (click)="this.selectedFragment = this.selectedLine = ''"
            (click)="this.fragmentForm.reset(); this.contentForm.reset(); this.contextForm.reset()"
            (click)="this.selectedEditorArray = CreateEditorArray(editorData.id, this.F_Fragments)"
            (click)="this.fragmentNumberList = GetFragmentNumbers(editorData.id, this.selectedEditorArray)">
                {{ editorData.name }}                       
            </mat-option>
            </mat-select>
            <mat-hint>Select an editor</mat-hint>
        </mat-form-field>
            
        <mat-form-field class="select-form">
            <mat-label>Fragment</mat-label>
            <mat-select [(ngModel)]="selectedFragment">
            <mat-option *ngFor="let fragmentData of this.fragmentNumberList" [value]="fragmentData"
            (click)="this.selectedLine = ''"
            (click)="this.fragmentForm.reset(); this.contentForm.reset(); this.contextForm.reset()"
            (click)="updateFragmentForm('fragmentNumber',fragmentData)"
            (click)="this.RequestReferencerID(this.selectedFragment, this.selectedEditor.id, this.selectedBook.id)"
            (click)="this.lineNumberList = GetLineNumbers(fragmentData, this.selectedEditorArray)">
                {{ fragmentData }} 
            </mat-option>
            </mat-select>
            <mat-hint>Select a fragment</mat-hint>
        </mat-form-field>      
        
        <mat-form-field class="select-form">
            <mat-label>Line</mat-label>
            <mat-select [(ngModel)]="selectedLine">
            <mat-option *ngFor="let lineData of this.lineNumberList" [value]="lineData"
            (click)="updateFragmentForm('lineNumber',lineData)"
            (click)="updateFragmentForm('lineStatus',GetFragmentStatus(this.selectedFragment, this.selectedEditorArray))"
            (click)="updateFragmentForm('lineContent',GetFragmentLine(lineData, this.selectedFragment, this.selectedEditorArray))">            
              {{ lineData }} 
            </mat-option>
            </mat-select>
            <mat-hint>Select a line</mat-hint>
        </mat-form-field>            
    </div>
</div>

<hr>

<!-- TAB GROUPS TO ENTER DATA -->
<div class="container-fluid">
    <div class="row">
        <mat-tab-group>
            <mat-tab label="Add/Remove Items"><br>
                <!-- Group to add/remove Authors, Books and Editors -->
                <mat-tab-group>
                  <!-- Tab to add/remove Authors -->
                    <mat-tab label="Author"><br>
                        <div mat-dialog-content>
                        <mat-form-field class="input-form">
                            <input matInput placeholder="Add author" [(ngModel)]='inputAuthor'>
                            <mat-hint>Fill in the name of a new author</mat-hint>
                        </mat-form-field>
                        </div>  
            
                        <br>
                        <button mat-button (click)="RequestCreateAuthor(inputAuthor)">Create added author</button>
                        <button mat-button (click)="RequestDeleteAuthor(this.selectedAuthor.id)">Delete selected author</button>
                    </mat-tab>
        
                    <!-- Tab to add/remove Books -->
                    <mat-tab label="Book"><br>
            
                        <div mat-dialog-content>
                        <mat-form-field class="input-form">
                            <input matInput placeholder="Add book" [(ngModel)]='inputBook'>
                            <mat-hint>Select an author and fill in the name of his/her new book</mat-hint>
                        </mat-form-field>
                        </div>  
            
                        <br>
                        <button mat-button (click)="RequestCreateBook(inputBook, this.selectedAuthor.id)">Create added book</button>
                        <button mat-button (click)="RequestDeleteBook(this.selectedBook.id, this.selectedAuthor.id)">Delete selected book</button>
                    </mat-tab>
        
                    <!-- Tab to add/remove Editors -->
                    <mat-tab label="Editor"><br>         
                        <div mat-dialog-content>
                        <mat-form-field class="input-form">
                            <input matInput placeholder="Add editor" [(ngModel)]='inputEditor'>
                            <mat-hint>Select an author and book and fill in the name of its new editor</mat-hint>
                        </mat-form-field>
                        </div>  
                        <br>
                        <button mat-button (click)="RequestCreateEditor(inputEditor, this.selectedBook.id, this.selectedAuthor.id)">Create added editor</button>
                        <button mat-button (click)="RequestDeleteEditor(this.selectedEditor.id, this.selectedBook.id, this.selectedAuthor.id)">Delete selected editor</button>
                        <button mat-button (click)="RequestSetMainEditor(this.selectedEditor.id, this.selectedBook.id, this.selectedAuthor.id)">Set selected editor as main editor</button>
                        <button mat-button (click)="RequestDeleteMainEditor(this.selectedEditor.id, this.selectedBook.id, this.selectedAuthor.id)">Remove selected editor as main editor</button>
            
                    </mat-tab>
                </mat-tab-group>
            </mat-tab>
        
            <mat-tab label="Create/Revise Fragment"><br> 
              <form [formGroup]="fragmentForm" (ngSubmit)="RequestCreateFragment(fragmentForm.value, this.selectedEditor.id, this.selectedBook.id)">

                <mat-form-field class="input-form-full-width">
                  <mat-label>Fragment number</mat-label>
                  <input matInput type="text" formControlName="fragmentNumber" required>
                  <mat-hint>Provide the name of the fragment</mat-hint>                       
                </mat-form-field>
              
                <div class="div-padding-sm"></div>

                <mat-form-field class="input-form-full-width">
                  <mat-label>Line number</mat-label>
                  <input matInput type="text" formControlName="lineNumber" required>
                  <mat-hint>Provide the name of the line</mat-hint>                       
                </mat-form-field>
              
                <div class="div-padding-sm"></div>

                <mat-form-field class="input-form-full-width">
                  <mat-label>Line content</mat-label>
                  <input matInput type="text" formControlName="lineContent" required>
                  <mat-hint>Provide the content of the line</mat-hint>                       
                </mat-form-field>
                
                <div class="div-padding-sm"></div>

                <mat-form-field class="input-form-full-width">
                  <mat-label>Line status</mat-label>
                  <input matInput type="text" formControlName="lineStatus">
                  <mat-hint>Provide the status of the fragment</mat-hint>                       
                </mat-form-field>       
                <div class="div-padding"></div>
                <button mat-button type="submit" [disabled]="!fragmentForm.valid">Upload</button>
              </form>
              <div class="div-padding"></div>
              <button mat-button (click)="RequestDeleteFragment(this.selectedEditor.id, this.selectedBook.id, this.selectedFragment)">Deleted selected Fragment</button>

              </mat-tab>

            <!-- Tab Group to change a fragment. -->

            <mat-tab label="Create/Revise Content"><br>
                <h4>Select one of the fragments to change its contents fields. Only changes will be saved.</h4>
                <!-- Uses form group! On pressing upload, changes will be put in the form. -->
                <form [formGroup]="contentForm" (ngSubmit)="RequestReviseContent(contentForm.value)">
                                                        
                  <mat-form-field class="input-form-full-width">
                    <mat-label>Fragment translation</mat-label>
                    <input matInput type="text" formControlName="translation">
                    <mat-hint>Provide the revised translation of the selected fragment</mat-hint>                       
                  </mat-form-field>
                  
                  <div class="div-padding-sm"></div>

                  <mat-form-field class="input-form-full-width">
                    <mat-label>Fragment apparatus criticus</mat-label>
                    <input matInput type="text" formControlName="apparatus">
                    <mat-hint>Provide the revised apparatus criticus of the selected fragment</mat-hint>                       
                  </mat-form-field>

                  <div class="div-padding-sm"></div>
          
                  <mat-form-field class="input-form-full-width">
                    <mat-label>Fragment differences</mat-label>
                    <input matInput type="text" formControlName="differences">
                    <mat-hint>Provide the revised differences of the selected fragment</mat-hint>                       
                  </mat-form-field>

                  <div class="div-padding-sm"></div>

                  <mat-form-field class="input-form-full-width">
                    <mat-label>Fragment commentary</mat-label>
                    <input matInput type="text" formControlName="commentary">
                    <mat-hint>Provide the revised commentary of the selected fragment</mat-hint>                       
                  </mat-form-field>
                  
                  <div class="div-padding-sm"></div>

                  <mat-form-field class="input-form-full-width">
                    <mat-label>Fragment reconstruction</mat-label>
                    <input matInput type="text" formControlName="reconstruction">
                    <mat-hint>Provide the revised reconstruction of the selected fragment</mat-hint>                       
                  </mat-form-field>                  
                  

                  <!-- Button is linked via the submit type! -->
                  <br><br>
                  <button mat-button class="button" type="submit" [disabled]="!contentForm.valid">Upload</button>
                </form>
              </mat-tab>
                    
              <!-- Tab to fix the context: select author and change its content. -->
              <mat-tab label="Revise/Create Context"><br>
                <h4>Select one of the fragments to change its context fields.</h4>
                <mat-form-field class="input-form">
                  <mat-label>Fragment context author</mat-label>
                  <mat-select>
                    <mat-option *ngFor="let item of this.F_Context" [value]="item.id"
                    (click)="SelectCorrespondingContext(item)"
                    (click)="updateContextForm('contextAuthor',item.contextAuthor)"
                    (click)="updateContextForm('context',item.context)">                  
                      {{ item.contextAuthor }}                       
                    </mat-option>
                  </mat-select>
                  <mat-hint>Select the author of the requested context for the selected fragment</mat-hint>
                </mat-form-field>
                <div class="div-padding-sm"></div>

                <form [formGroup]="contextForm" (ngSubmit)="RequestReviseContext(contextForm.value)">

                  <mat-form-field class="input-form-full-width">
                    <mat-label>Context Author</mat-label>
                    <input matInput type="text" formControlName="contextAuthor" required>
                    <mat-hint>Provide the context author</mat-hint>                       
                  </mat-form-field>                  

                  <mat-form-field class="input-form-full-width">
                    <mat-label>Context</mat-label>
                    <input matInput type="text" formControlName="context" required>
                    <mat-hint>Provide the context</mat-hint>                       
                  </mat-form-field>             
                  
                  <!-- Button is linked via the submit type! -->
                  <div class="div-padding"></div>
                  <button mat-button class="button" type="submit">Revise Selected Context</button>
                </form>
                <div class="div-padding"></div>    
                <button mat-button (click)="RequestCreateContext(contextForm.value)" [disabled]="!contextForm.valid">Create New Context</button>
    
              </mat-tab>

              <mat-tab label="Publish"><br>
                <button mat-button (click)="this.RequestPublishFlag(this.selectedEditor.id, this.selectedBook.id, this.selectedFragment, 1)">Publish selected fragment</button>
                <button mat-button (click)="this.RequestPublishFlag(this.selectedEditor.id, this.selectedBook.id, this.selectedFragment, 0)">Unpublish selected fragment</button>
            </mat-tab>

            

        </mat-tab-group>
        

    </div>
</div>